<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=yes">
    <title>PDF Viewer</title>
    <style>
        canvas {
            width: 100%;
            height: auto;
        }
        html {
            touch-action: manipulation;
        }
    </style>
</head>
<body>
<div id="loader-container">
    <div class="loader"></div>
</div>

<script src="https://mozilla.github.io/pdf.js/build/pdf.mjs" type="module"></script>
<script type="module">
        console.log("Script started")
        var { pdfjsLib } = globalThis;
        pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.mjs';

        window.loadPDF = async function loadPDF(fetchMode) {
            var url = 'data:application/pdf;base64,' + pdfBase64;

            const loadingTask = pdfjsLib.getDocument({
                url,
                withCredentials: true,
                mode: fetchMode,
            });

            try {
                const pdf = await loadingTask.promise;
                console.log('PDF loaded');

                const container = document.getElementById('pdf-container');

                for (let pageNumber = 1; pageNumber <= pdf.numPages; pageNumber++) {
                    const page = await pdf.getPage(pageNumber);
                    console.log('Page loaded');

                    const scale = 1.5;
                    const viewport = page.getViewport({ scale: scale });

                    const canvas = document.createElement('canvas');
                    container.appendChild(canvas);

                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport,
                    };
                    const renderTask = page.render(renderContext);
                    await renderTask.promise;
                    console.log(`Page ${pageNumber} rendered`);
                }
            } catch (reason) {
                console.error("PDF loading failed for the following reasons:");
                console.error(JSON.stringify(reason, null, 2));
            }
        }

        console.log("Script loaded")
    </script>

<div id="pdf-container"></div>
</body>
</html>
